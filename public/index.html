<!DOCTYPE html >
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>My Amazing SoundCloud Catalog</title>
    <link href="reset.css" type="text/css" rel="stylesheet">
    <link href="index.css" type="text/css" rel="stylesheet">
    <script src="http://connect.soundcloud.com/sdk.js"></script>
    <script src="https://w.soundcloud.com/player/api.js"></script>
  </head>

  <body>
  <!--
    <iframe id="sc-widget" src="https://w.soundcloud.com/player/?url=http://api.soundcloud.com/users/1539950/favorites" width="100%" height="465" scrolling="no" frameborder="no"></iframe>
<script src="https://w.soundcloud.com/player/api.js" type="text/javascript"></script> -->

<script type="text/javascript">
//   (function(){
//     var widgetIframe = document.getElementById('sc-widget'),
//         widget       = SC.Widget(widgetIframe);

//     widget.bind(SC.Widget.Events.READY, function() {
//       widget.bind(SC.Widget.Events.PLAY, function() {
//         // get information about currently playing sound
//         widget.getCurrentSound(function(currentSound) {
//           console.log('sound ' + currentSound.get('') + 'began to play');
//         });
//       });
//       // get current level of volume
//       widget.getVolume(function(volume) {
//         console.log('current volume value is ' + volume);
//       });
//       // set new volume level
//       widget.setVolume(50);
//       // get the value of the current position
//     });

//   }());

</script>
    <h1>My Amazing SoundCloud Catalog</h1>

    <input type="text" id="search" onchange="doSearch()" />

    <button id="clear">Clear</button>

    <div id="catalog">
    </div>

    <script>
      SC.initialize({
        client_id: '4f0f49d2e8de7886ae21480b0b2a9487'
      });

      function doSearch() {
        var searchTerm = document.getElementById('search').value;

        // Encode spaces
        searchTerm = searchTerm.replace(" ", "+");

        // Search soundcloud for artists
        SC.get('/tracks', { q: searchTerm, license: 'cc-by-sa' }, function(tracks){
            for(track in tracks) {
              console.log(tracks[track]);
              var catalog = document.getElementById("catalog");
              var image = document.createElement("img");
              var link = document.createElement("a");
              var div = document.createElement("div");
              div.setAttribute("class", "track-info");
              link.appendChild(image);
              div.appendChild(link);
              //div.setAttribute("style", "display:inline-block")
              catalog.appendChild(div);
              link.setAttribute("class", "show-info");
              link.setAttribute("href", "#");
              image.setAttribute("src", tracks[track].artwork_url);
              link.setAttribute("id", tracks[track].description);
              //When I use the onclick method on link I always get only the last link's description. So I have to prevent a closure and change the scope of this loop so as to make the link description work for every link.
              //Inspiration from here:
              //http://stackoverflow.com/questions/1140089/why-do-you-need-to-invoke-an-anonymous-function-on-the-same-line
              //http://www.mennovanslooten.nl/blog/post/62
              link.onclick = (function(){
                return function() {
                  var description = document.createElement("p");
                  description.innerText = this.id
                  var popup = document.createElement("div");
                  popup.setAttribute("class", "popup");
                  var modal = document.createElement("div");
                  modal.setAttribute("class", "modal");
                  popup.appendChild(modal);
                  modal.appendChild(description);
                  catalog.appendChild(popup);
                  var button = document.createElement("button")
                  button.innerText = "Hide"
                  // button.setAttribute("content", "'Hide'")
                  modal.appendChild(button);

                  button.onclick = (function(){
                    catalog.removeChild(popup);
                  });
                }
              })(track);
            }
          }
        );
        // SC.Widget.SEEK
      };



      // function showInfo() {

      // }
    </script>
  </body>

</html>